<div class="wrapper">
    <v-table-info-bar
        [count]="count()"
        [hasMore]="hasMore()"
        [progress]="progress()"
    ></v-table-info-bar>

    <mat-card class="card">
        <v-table-progress-bar [progress]="progress()"></v-table-progress-bar>
        <table [dataSource]="dataSource" mat-table>
            @for (col of normalizedColumns(); track col; let colIndex = $index) {
                <ng-container [matColumnDef]="col.field">
                    <th *matHeaderCellDef mat-header-cell>
                        <v-value [value]="col.header | async" inline></v-value>
                    </th>
                    <td
                        *matCellDef="let row; let rowIndex = index"
                        [ngStyle]="col?.params?.style"
                        mat-cell
                    >
                        @if ((columnsData$$ | async)?.[colIndex]?.[rowIndex] | async; as cellData) {
                            @if (cellData.length > 1) {
                                <div class="multi-cell">
                                    @for (item of cellData; track item) {
                                        <v-value [value]="item" inline></v-value>
                                    }
                                </div>
                            } @else {
                                <v-value [value]="cellData[0]" inline></v-value>
                            }
                        }
                    </td>
                </ng-container>
            }
            <v-no-records-column
                [name]="columnDefs.noRecords"
                [progress]="progress()"
            ></v-no-records-column>

            <tr *matHeaderRowDef="rowDefs(); sticky: true" mat-header-row></tr>
            <tr *matRowDef="let row; columns: rowDefs()" mat-row></tr>
            <tr
                *matFooterRowDef="footerRowDefs()"
                [style.display]="footerRowDefs().length ? '' : 'none'"
                mat-footer-row
            ></tr>
        </table>
    </mat-card>

    @if (!infinityScroll() && (hasMore() || dataSource.paginator.length < count())) {
        <v-show-more-button
            [displayedPages]="dataSource.paginator.displayedPages"
            [length]="count()"
            [pageSize]="size()"
            [progress]="progress()"
            (more)="showMore()"
        ></v-show-more-button>
    }
</div>
