<div class="table">
    <v-actions *ngIf="!noActions">
        <v-actions>
            <ng-container *ngIf="update.observed">
                <button
                    [disabled]="!!progress"
                    mat-stroked-button
                    (click)="update.emit(this.size$.value ? { size: this.size$.value } : {})"
                >
                    Update
                </button>
                <button
                    *ngIf="rowSelectable"
                    [disabled]="!!progress || !hasMore"
                    mat-button
                    (click)="more.emit()"
                >
                    Get more
                </button>
            </ng-container>
            <ng-container *ngIf="renderedSizes.length">
                <button [disabled]="!!progress" [matMenuTriggerFor]="menu" mat-button>
                    {{ size$ | async }} <mat-icon>table_rows_narrow</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                    <button
                        *ngFor="let size of renderedSizes"
                        mat-menu-item
                        (click)="size$.next(size)"
                    >
                        {{ size }}
                    </button>
                </mat-menu>
            </ng-container>
        </v-actions>
        <div>
            <ng-content select="v-table-actions"></ng-content>
        </div>
    </v-actions>
    <div class="details">
        <div>
            <ng-container *ngIf="data?.length">
                Quantity: {{ data?.length ?? 0
                }}{{ hasMore ? ' (more available)' : '/' + (data?.length ?? 0)
                }}{{ internalSelected?.length ? '. Selected: ' + internalSelected.length : '' }}
            </ng-container>
        </div>
        <div class="customize">
            <mat-icon *ngIf="hasReset" (click)="updateColumns()">restart_alt</mat-icon>
            <span [matMenuTriggerFor]="columnMenu.menuPanel" class="action">Customize columns</span>
            <mtx-grid-column-menu
                #columnMenu
                [columns]="renderedColumns"
                buttonText="test"
                class="column-menu"
                (columnChange)="updateColumns($event)"
            ></mtx-grid-column-menu>
        </div>
    </div>
    <mat-card class="table-card">
        <mtx-grid
            *ngIf="renderedColumns"
            [cellSelectable]="false"
            [cellTemplate]="renderedCellTemplate"
            [columnHideable]="true"
            [columnPinnable]="true"
            [columnResizable]="true"
            [columns]="renderedColumns"
            [columnSortable]="true"
            [data]="data || []"
            [emptyValuePlaceholder]="''"
            [loading]="!!progress || !columns"
            [paginationTemplate]="footerTpl"
            [rowSelectable]="!!rowSelectable"
            [rowSelected]="rowSelected"
            [sortActive]="sortActive || ''"
            [sortDirection]="sortDirection || ''"
            [sortDisabled]="!!progress"
            [sortOnFront]="false"
            [trackBy]="trackByField ? trackByFieldFn : trackBy"
            columnHideableChecked="show"
            (rowSelectionChange)="select($event)"
            (sortChange)="sortChange.emit($event)"
        ></mtx-grid>
        <ng-template #cellTpl let-col="colDef" let-index="index" let-row>
            <v-table-cell [colDef]="col" [index]="index" [rowData]="row"></v-table-cell>
        </ng-template>
        <ng-template #footerTpl>
            <div *ngIf="hasMore" class="show-more-wrapper">
                <button
                    [disabled]="!!progress"
                    class="show-more"
                    mat-button
                    (click)="more.emit(this.size$.value ? { size: this.size$.value } : {})"
                >
                    {{ progress ? 'Loading...' : 'Show more' }}
                </button>
            </div>
        </ng-template>
    </mat-card>
</div>
