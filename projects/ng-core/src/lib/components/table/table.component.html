<div class="table">
    <v-actions *ngIf="!noActions">
        <v-actions>
            <ng-container *ngIf="update.observed">
                <button
                    [disabled]="!!progress"
                    mat-stroked-button
                    (click)="update.emit(this.size$.value ? { size: this.size$.value } : {})"
                >
                    Update
                </button>
                <button
                    *ngIf="rowSelectable"
                    [disabled]="!!progress || !hasMore"
                    mat-button
                    (click)="more.emit()"
                >
                    Get more
                </button>
            </ng-container>
            <ng-container *ngIf="renderedSizes.length">
                <button [disabled]="!!progress" [matMenuTriggerFor]="menu" mat-button>
                    {{ size$ | async }} <mat-icon>table_rows_narrow</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                    <button
                        *ngFor="let size of renderedSizes"
                        mat-menu-item
                        (click)="size$.next(size)"
                    >
                        {{ size }}
                    </button>
                </mat-menu>
            </ng-container>
            <!--            TODO: there are problems with resetting, it does not reset when for example many columns are hidden-->
            <!--            <button *ngIf="hasReset" mat-button (click)="reset()">Reset</button>-->
        </v-actions>
        <div>
            <ng-content select="v-table-actions"></ng-content>
        </div>
    </v-actions>
    <div class="details">
        <div *ngIf="data?.length">
            Quantity: {{ data?.length ?? 0
            }}{{ hasMore ? ' (more available)' : '/' + (data?.length ?? 0)
            }}{{
                (rowSelected || internalSelected)?.length
                    ? '. Selected: ' + (rowSelected || internalSelected).length
                    : ''
            }}
        </div>
        <div></div>
        <ng-container>
            <span [matMenuTriggerFor]="columnMenu.menuPanel" class="action">Customize columns</span>
            <mtx-grid-column-menu
                #columnMenu
                [columns]="renderedColumns"
                buttonText="test"
                class="column-menu"
                (columnChange)="updateColumns($event)"
            ></mtx-grid-column-menu>
        </ng-container>
    </div>
    <mat-card class="table-card">
        <mtx-grid
            *ngIf="renderedColumns"
            [cellSelectable]="false"
            [cellTemplate]="renderedCellTemplate"
            [columnHideable]="true"
            [columnPinnable]="true"
            [columnResizable]="true"
            [columns]="renderedColumns"
            [columnSortable]="true"
            [data]="data || []"
            [emptyValuePlaceholder]="''"
            [loading]="!!progress || !columns"
            [paginationTemplate]="footerTpl"
            [rowSelectable]="!!rowSelectable"
            [rowSelected]="rowSelected"
            [sortActive]="sortActive || ''"
            [sortDirection]="sortDirection || ''"
            [sortDisabled]="!!progress"
            [sortOnFront]="false"
            [trackBy]="trackByField ? trackByFieldFn : trackBy"
            columnHideableChecked="show"
            (rowSelectionChange)="rowSelectionChange.emit($event); internalSelected = $event"
            (sortChange)="sortChange.emit($event)"
        ></mtx-grid>
        <v-table-menu-cell-template
            (templateChange)="cellTemplates.set('menu', $event)"
        ></v-table-menu-cell-template>
        <v-table-description-cell-template
            (templateChange)="cellTemplates.set('description', $event)"
        ></v-table-description-cell-template>
        <v-table-tag-cell-template
            (templateChange)="cellTemplates.set('tag', $event)"
        ></v-table-tag-cell-template>
        <v-table-currency-cell-template
            (templateChange)="cellTemplates.set('currency', $event)"
        ></v-table-currency-cell-template>
        <ng-template #footerTpl>
            <div *ngIf="hasMore" class="show-more-wrapper">
                <button
                    [disabled]="!!progress"
                    class="show-more"
                    mat-button
                    (click)="more.emit(this.size$.value ? { size: this.size$.value } : {})"
                >
                    {{ progress ? 'Loading...' : 'Show more' }}
                </button>
            </div>
        </ng-template>
    </mat-card>
</div>
