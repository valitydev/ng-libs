<mat-form-field>
    <mat-label>{{ label }}</mat-label>

    <mtx-select
        [closeOnSelect]="!multiple"
        [formControl]="control"
        [items]="options"
        [markFirst]="true"
        [multiple]="multiple"
        [required]="required"
        [searchable]="true"
        [searchFn]="search"
        [selectableGroup]="true"
        [selectableGroupAsModel]="false"
        bindLabel="label"
        bindValue="value"
        groupBy="type"
    >
        <ng-template let-index="index" let-item="item" let-item$="item$" ng-optgroup-tmp>
            <mat-checkbox
                *ngIf="multiple; else text"
                [ngModel]="item$.selected"
                class="checkbox-option"
                id="item-{{ index }}"
            >
                {{ item.type | uppercase }}
            </mat-checkbox>
            <ng-template #text>
                {{ item.type | uppercase }}
            </ng-template>
        </ng-template>
        <ng-template let-index="index" let-item="item" let-item$="item$" ng-option-tmp>
            <mat-checkbox
                *ngIf="multiple; else text"
                [ngModel]="item$.selected"
                class="checkbox-option"
                id="item-{{ index }}"
            >
                <ng-container *ngTemplateOutlet="text"></ng-container>
            </mat-checkbox>
            <ng-template #text>
                <div class="label">{{ item.label }}</div>
                <div *ngIf="item.description" class="mat-caption mat-secondary-text">
                    {{ item.description }}
                </div>
            </ng-template>
        </ng-template>
    </mtx-select>

    <mat-hint>{{
        hint ||
            (multiple && options && options.length > 1
                ? (control.value?.length || 0) + '/' + options.length
                : '')
    }}</mat-hint>
    <mat-error>{{ error }}</mat-error>
</mat-form-field>
